<!DOCTYPE html>
<html>
<head>
<title>hora</title>
</head>
<body>

<h2>La hora suena</h2>

<p id="frecuencia">Senoide que cambia su frecuencia.</p>

<button onclick="suena()">Iniciar</button>

<script>

var freq = 100;
var oscillator = null; /////
//var myhour = 0;
//var date = new Date();
var audioCtx = null;
var hiloActualizaFreqID = window.setInterval(actualizaFreq, 10000);

window.addEventListener('load', init, false);
function init() {
  try {
    // Fix up for prefixing
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  }
  catch(e) {
    alert('Web Audio API is not supported in this browser');
  }
	oscillator = audioCtx.createOscillator();
	oscillator.frequency.value = freq;
	oscillator.connect(audioCtx.destination);
}

function suena(){
	oscillator.start();
  return "Sonando...";
}

///// Reorden√©
function map(tl, a1, a2, b1, b2) {
  var stretch = (b2 - b1)/(a2 - a1); //////
   return (tl - a1)*(stretch) + b1; //////
}

function actualizaFreq(){
  //var nueva_date = new Date();
	var minutos = (new Date()).getSeconds();
	//myhour = minutos;
	freq = map(minutos, 0, 59, 40, 400);
  console.log("minutos: " + minutos);
  console.log("freq: " + freq);
	if(oscillator != null){ ///////
 		oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
	}
}

init();
</script>

</body>
</html>
